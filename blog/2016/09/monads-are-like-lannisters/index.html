
    

<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>Monads are like Lannisters</title>

    <meta name="twitter:site" content="@snoyberg">
    <meta name="twitter:creator" content="@snoyberg">
    <meta name="og:site_name" content="Michael Snoyman's homepage">
    <meta name="og:title" content="Monads are like Lannisters">
    <meta name="og:type content="website">

    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"> 
    <link rel="stylesheet" href="/maxi/vendors/font-awesome/css/fontawesome-all.min.css">
    <link rel="stylesheet" type="text/css" href="/maxi/css/styles.css">

    






    <link rel="openid2.provider" href="https://openid.stackexchange.com/openid/provider">
    <link rel="openid2.local_id" href="https://openid.stackexchange.com/user/d26546d2-46db-4099-83ca-e1eccfa0dd8d">
    <link href="/rss.xml" type="application/atom+xml" rel="alternate" title="Michael Snoyman's blog">

    <style>.wt-section { padding-top: 2rem }</style>
  <body>
    <header class="inner-page">
      

<nav class="js-navbar-scroll navbar fixed-top navbar-expand-lg">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">
      <img src="/img/snoylogo.png" height="50px">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo" aria-controls="navbarTogglerDemo" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse onCollapse" id="navbarTogglerDemo">
      <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="/blog">Blog</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://www.yesodweb.com/">Yesod</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="http://shop.oreilly.com/product/0636920035664.do">Yesod Book</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://www.beginrust.com/">Rust Book</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://www.youtube.com/c/snoyberg">YouTube</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://twitter.com/snoyberg">Twitter</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://github.com/snoyberg">Github</a>
        </li>
      </ul>
    </div>
  </div>
</nav>



      <section class="wt-section bg-gray text-center inner-page-header" style="padding-top:100px">
        <div class="container">
          <div class="row justify-content-md-center align-items-center text-white py-lg-5">
            <div class="col-md-7">
              <div class="text-center">
                <h1 class="display-sm-4 display-lg-3">Monads are like Lannisters</h1>
                
<p class="h6 text-uppercase wt-letter-spacing-sm mb-0">Published September 12, 2016</p>

              </div>
            </div>
          </div>
        </div>
      </section>
    </header>

    <main role="main">
      <section class="wt-section">
        <div class="container">
          <div class="row justify-content-between">
            <div class="col-lg-12">
              <p class="text-center">
                <a class="btn" style="background: #72472f; color: #fff; font-weight: bold" href="https://www.beginrust.com/">New: The "Begin Rust" book</a>
              </p>

              




  


<div class="share-bar-wrapper">
  <div class="share-bar-inner">
    <b>Share this</b>
    <a target="_blank" href="https://twitter.com/intent/tweet?text=Monads%20are%20like%20Lannisters https%3A&#x2F;&#x2F;www.snoyman.com&#x2F;blog&#x2F;2016&#x2F;09&#x2F;monads-are-like-lannisters&#x2F;" title="Share on Twitter">
      <i class="fab fa-twitter"></i>
    </a>

    <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A&#x2F;&#x2F;www.snoyman.com&#x2F;blog&#x2F;2016&#x2F;09&#x2F;monads-are-like-lannisters&#x2F;" title="Share on Facebook">
      <i class="fab fa-facebook"></i>
    </a>

    <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A&#x2F;&#x2F;www.snoyman.com&#x2F;blog&#x2F;2016&#x2F;09&#x2F;monads-are-like-lannisters&#x2F;&amp;title=Monads%20are%20like%20Lannisters" title="Share on LinkedIn">
      <i class="fab fa-linkedin"></i>
    </a>

    <a target="_blank" href="https://www.reddit.com/submit?url=https%3A&#x2F;&#x2F;www.snoyman.com&#x2F;blog&#x2F;2016&#x2F;09&#x2F;monads-are-like-lannisters&#x2F;" title="Share on Reddit">
      <i class="fab fa-reddit"></i>
    </a>
  </div>
</div>



<!--
<div class="container" id="blog-body">
  <div class="row">
    <div class="col-lg-9">
-->
      <p>
        <i>
          See a typo? Have a suggestion?
          <a target="_blank" rel="nofollow" href="https://github.com/snoyberg/snoyman.com/edit/master/content/blog&#x2F;monads-are-like-lannisters.md">Edit this page on Github</a>
        </i>
      </p>

      <p>As many people are likely aware, monads (incorrectly) have a bad rap
in the programming community for being difficult to learn. A string of
extremely flawed monad tutorials based on analogies eventually led to
a
<a href="https://byorgey.wordpress.com/2009/01/12/abstractsion-intuition-and-the-monad-tutorial-fallacy/">blog post by Brent Yorgey</a>
about the flaws of this analogy-based approach. And we've seen
<a href="http://haskellbook.com/">great</a>
<a href="http://blog.sigfpe.com/2006/08/you-could-have-invented-monads-and.html">learning</a>
<a href="https://haskell-lang.org/documentation">materials</a> on Haskell and
monads.</p>
<p>However, I'm disappointed to see the analogy-based route
disappear. Based on a
<a href="https://twitter.com/snoyberg/status/773892889868963841">recent Twitter poll</a>
I ran, which is held to the highest levels of scientific and
statistical scrutiny, it's obvious that there is very high demand for
a rigorous analogy-based monad tutorial. I claim that the flaw in all
previous analogy based tutorials is lack of strong pop culture
references. Therefore, I'm happy to announce the definitive guide to
monads: Monads are like Lannisters.</p>
<p>Spoiler alert: if you haven't completed book 5 or season 6 of Haskell
yet, there <em>will</em> be spoilers.</p>
<h2 id="prereqs">Prereqs</h2>
<p>The examples below will all be Haskell scripts that can be run with
the Stack build tool. Please
<a href="https://haskell-lang.org/get-started">grab Stack to play along</a>. Copy-paste
the full example into a file like <code>foo.hs</code> and then run it with <code>stack foo.hs</code>. (This uses Stack's
<a href="https://www.fpcomplete.com/blog/2016/08/bitrot-free-scripts">script interpreter support</a>.)</p>
<h2 id="hear-me-roar">Hear me roar</h2>
<p>Many people believe that the Lannister house words are &quot;A Lannister
always pays his debts&quot; (or her debts of course). We'll get to that
line in a moment. This belief however is false: the <em>true</em> Lannister
house words are <strong>Hear me roar</strong>. So let's hear a Lannister roar:</p>
<pre style="background-color:#fdf6e3;">
<code><span style="color:#657b83;">#</span><span style="color:#859900;">!/</span><span style="color:#657b83;">usr</span><span style="color:#859900;">/</span><span style="color:#657b83;">bin</span><span style="color:#859900;">/</span><span style="color:#657b83;">env stack
</span><span style="color:#93a1a1;">-- stack --resolver lts-6.15 --install-ghc runghc

</span><span style="color:#b58900;">roar </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">roar </span><span style="color:#859900;">=</span><span style="color:#657b83;"> putStrLn </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">Roar</span><span style="color:#839496;">&quot;

</span><span style="color:#b58900;">main </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">main </span><span style="color:#859900;">= do</span><span style="color:#657b83;">
    roar </span><span style="color:#93a1a1;">-- Tywin
</span><span style="color:#657b83;">    roar </span><span style="color:#93a1a1;">-- Cersei
</span><span style="color:#657b83;">    roar </span><span style="color:#93a1a1;">-- Jaime
</span><span style="color:#657b83;">    roar </span><span style="color:#93a1a1;">-- Tyrion
</span></code></pre>
<p>Roaring is clearly an <em>output</em>, and therefore it makes sense that our
action is an <code>IO</code> action. But roaring doesn't really do much besides
making sound, so its return is the empty value <code>()</code>. In our <code>main</code>
function, we use <code>do</code> notation to roar multiple times. But we can just
as easily use the <code>replicateM_</code> function to replicate a monadic action
multiple times and discard (that's what the <code>_</code> means) the results:</p>
<pre style="background-color:#fdf6e3;">
<code><span style="color:#657b83;">#</span><span style="color:#859900;">!/</span><span style="color:#657b83;">usr</span><span style="color:#859900;">/</span><span style="color:#657b83;">bin</span><span style="color:#859900;">/</span><span style="color:#657b83;">env stack
</span><span style="color:#93a1a1;">-- stack --resolver lts-6.15 --install-ghc runghc

</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">Control.Monad </span><span style="color:#657b83;">(</span><span style="color:#b58900;">replicateM_</span><span style="color:#657b83;">)

</span><span style="color:#b58900;">roar </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">roar </span><span style="color:#859900;">=</span><span style="color:#657b83;"> putStrLn </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">Roar</span><span style="color:#839496;">&quot;

</span><span style="color:#b58900;">main </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">main </span><span style="color:#859900;">=</span><span style="color:#657b83;"> replicateM_ </span><span style="color:#6c71c4;">4</span><span style="color:#657b83;"> roar
</span></code></pre><h2 id="tyrion-the-scholar">Tyrion, the scholar</h2>
<p>As we all know, Tyrion is a prolific scholar, consuming essentially
any book he can get his hands on (we'll discuss some other consumption
next). Fortunately, monads are there to back him up, with the <code>Reader</code>
monad. Let's say that Tyrion is doing some late night research on wine
production (epic foreshadowment) in various kingdoms, and wants to
produce a total:</p>
<pre style="background-color:#fdf6e3;">
<code><span style="color:#657b83;">#</span><span style="color:#859900;">!/</span><span style="color:#657b83;">usr</span><span style="color:#859900;">/</span><span style="color:#657b83;">bin</span><span style="color:#859900;">/</span><span style="color:#657b83;">env stack
</span><span style="color:#93a1a1;">-- stack --resolver lts-6.15 --install-ghc runghc

</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">Data.Map </span><span style="color:#657b83;">(</span><span style="color:#268bd2;">Map</span><span style="color:#657b83;">)
</span><span style="color:#cb4b16;">import qualified </span><span style="color:#859900;">Data.Map </span><span style="color:#cb4b16;">as </span><span style="color:#859900;">Map
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">Control.Monad.Trans.Reader
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">Data.Maybe </span><span style="color:#657b83;">(</span><span style="color:#b58900;">fromMaybe</span><span style="color:#657b83;">)

</span><span style="color:#859900;">type </span><span style="color:#cb4b16;">Kingdom </span><span style="color:#859900;">= </span><span style="color:#cb4b16;">String
</span><span style="color:#859900;">type </span><span style="color:#cb4b16;">WineCount </span><span style="color:#859900;">= </span><span style="color:#cb4b16;">Int
</span><span style="color:#859900;">type </span><span style="color:#cb4b16;">WineData </span><span style="color:#859900;">= </span><span style="color:#cb4b16;">Map Kingdom WineCount

</span><span style="color:#b58900;">tyrionResearch </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">Reader WineData Int
</span><span style="color:#657b83;">tyrionResearch </span><span style="color:#859900;">= do</span><span style="color:#657b83;">
    mnorth </span><span style="color:#859900;">&lt;-</span><span style="color:#657b83;"> asks </span><span style="color:#859900;">$ </span><span style="color:#cb4b16;">Map</span><span style="color:#859900;">.</span><span style="color:#657b83;">lookup </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">north</span><span style="color:#839496;">&quot;</span><span style="color:#657b83;">
    mriverlands </span><span style="color:#859900;">&lt;-</span><span style="color:#657b83;"> asks </span><span style="color:#859900;">$ </span><span style="color:#cb4b16;">Map</span><span style="color:#859900;">.</span><span style="color:#657b83;">lookup </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">riverlands</span><span style="color:#839496;">&quot;</span><span style="color:#657b83;">
    return </span><span style="color:#859900;">$</span><span style="color:#657b83;"> fromMaybe </span><span style="color:#6c71c4;">0</span><span style="color:#657b83;"> mnorth </span><span style="color:#859900;">+</span><span style="color:#657b83;"> fromMaybe </span><span style="color:#6c71c4;">0</span><span style="color:#657b83;"> mriverlands

</span><span style="color:#b58900;">main </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">main </span><span style="color:#859900;">=</span><span style="color:#657b83;"> print </span><span style="color:#859900;">$</span><span style="color:#657b83;"> runReader tyrionResearch </span><span style="color:#859900;">$ </span><span style="color:#cb4b16;">Map</span><span style="color:#859900;">.</span><span style="color:#657b83;">fromList
    [ (</span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">north</span><span style="color:#839496;">&quot;</span><span style="color:#657b83;">, </span><span style="color:#6c71c4;">5</span><span style="color:#657b83;">)
    , (</span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">riverlands</span><span style="color:#839496;">&quot;</span><span style="color:#657b83;">, </span><span style="color:#6c71c4;">10</span><span style="color:#657b83;">)
    , (</span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">reach</span><span style="color:#839496;">&quot;</span><span style="color:#657b83;">, </span><span style="color:#6c71c4;">2000</span><span style="color:#657b83;">)
    , (</span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">dorne</span><span style="color:#839496;">&quot;</span><span style="color:#657b83;">, </span><span style="color:#6c71c4;">1000</span><span style="color:#657b83;">)
    ]
</span></code></pre>
<p>While Tyrion may have chosen inferior kingdoms for wine production, it
does not take away from the fact that the <code>Reader</code> type has allowed
him access to data without having to explicitly pass it around. For an
example this small (no dwarf joke intended), the payoff isn't
great. But <code>Reader</code> is one of the simplest monads, and can be quite
useful for larger applications.</p>
<h2 id="tyrion-the-drinker">Tyrion, the drinker</h2>
<p>Let's try another one. We all know that Tyrion also likes to <em>drink</em>
wine, not just count it. So let's use our <code>Reader</code> monad to give him
access to a bottle of wine.</p>
<p><em>However</em>, unlike reading data from a book, drinking from a bottle
actually changes the bottle. So we have to leave our pure <code>Reader</code>
world and get into the <code>ReaderT IO</code> world instead. Also known as
<em>monad transformers</em>. (Unfortunately I don't have time now for a full
post on it, but consider: <strong>Transformers: Monads in Disguise</strong>.)</p>
<pre style="background-color:#fdf6e3;">
<code><span style="color:#657b83;">#</span><span style="color:#859900;">!/</span><span style="color:#657b83;">usr</span><span style="color:#859900;">/</span><span style="color:#657b83;">bin</span><span style="color:#859900;">/</span><span style="color:#657b83;">env stack
</span><span style="color:#93a1a1;">-- stack --resolver lts-6.15 --install-ghc runghc

</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">Control.Monad </span><span style="color:#657b83;">(</span><span style="color:#b58900;">replicateM_</span><span style="color:#657b83;">)
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">Control.Monad.Trans.Reader
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">Control.Monad.IO.Class
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">Control.Concurrent.Chan

data </span><span style="color:#cb4b16;">Wine </span><span style="color:#859900;">= </span><span style="color:#cb4b16;">Wine
</span><span style="color:#859900;">type </span><span style="color:#cb4b16;">Bottle </span><span style="color:#859900;">= </span><span style="color:#cb4b16;">Chan Wine

</span><span style="color:#b58900;">drink </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">MonadIO m </span><span style="color:#859900;">=&gt; </span><span style="color:#268bd2;">Bottle </span><span style="color:#859900;">-&gt; </span><span style="color:#268bd2;">m </span><span style="color:#859900;">()
</span><span style="color:#657b83;">drink bottle </span><span style="color:#859900;">=</span><span style="color:#657b83;"> liftIO </span><span style="color:#859900;">$ do
    </span><span style="color:#cb4b16;">Wine </span><span style="color:#859900;">&lt;-</span><span style="color:#657b83;"> readChan bottle
    putStrLn </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">Now I&#39;m slightly drunker</span><span style="color:#839496;">&quot;

</span><span style="color:#b58900;">tyrionDrinks </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">ReaderT Bottle IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">tyrionDrinks </span><span style="color:#859900;">=</span><span style="color:#657b83;"> replicateM_ </span><span style="color:#6c71c4;">10 </span><span style="color:#859900;">$ </span><span style="color:#cb4b16;">ReaderT</span><span style="color:#657b83;"> drink

</span><span style="color:#b58900;">main </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">main </span><span style="color:#859900;">= do
    </span><span style="color:#93a1a1;">-- Get a nice new bottle
</span><span style="color:#657b83;">    bottle </span><span style="color:#859900;">&lt;-</span><span style="color:#657b83;"> newChan

    </span><span style="color:#93a1a1;">-- Fill up the bottle
</span><span style="color:#657b83;">    replicateM_ </span><span style="color:#6c71c4;">20 </span><span style="color:#859900;">$</span><span style="color:#657b83;"> writeChan bottle </span><span style="color:#cb4b16;">Wine

    </span><span style="color:#93a1a1;">-- CHUG!
</span><span style="color:#657b83;">    runReaderT tyrionDrinks bottle
</span></code></pre><h2 id="a-lannister-always-pays-his-debts">A Lannister always pays his debts</h2>
<p>What is a debt, but receiving something from another and then
returning it? Fortunately, there's a monad for that too: the <code>State</code>
monad. It lets us take in some value, and then give it back - perhaps
slightly modified.</p>
<pre style="background-color:#fdf6e3;">
<code><span style="color:#657b83;">#</span><span style="color:#859900;">!/</span><span style="color:#657b83;">usr</span><span style="color:#859900;">/</span><span style="color:#657b83;">bin</span><span style="color:#859900;">/</span><span style="color:#657b83;">env stack
</span><span style="color:#93a1a1;">-- stack --resolver lts-6.15 --install-ghc runghc

</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">Control.Monad.Trans.State

type </span><span style="color:#cb4b16;">Sword </span><span style="color:#859900;">= </span><span style="color:#cb4b16;">String

</span><span style="color:#b58900;">forge </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">State Sword Sword
</span><span style="color:#657b83;">forge </span><span style="color:#859900;">= do
    </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">Ice</span><span style="color:#839496;">&quot; </span><span style="color:#859900;">&lt;-</span><span style="color:#657b83;"> get
    </span><span style="color:#93a1a1;">-- do our Valyrian magic, and...

    -- Repay our debt to Brienne
</span><span style="color:#657b83;">    put </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">Oathkeeper</span><span style="color:#839496;">&quot;

    </span><span style="color:#93a1a1;">-- And Tywin gets a sword too!
</span><span style="color:#657b83;">    return </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">Widows Wail</span><span style="color:#839496;">&quot;

</span><span style="color:#b58900;">killNedStark </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO Sword
</span><span style="color:#657b83;">killNedStark </span><span style="color:#859900;">= do</span><span style="color:#657b83;">
    putStrLn </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">Off with his head!</span><span style="color:#839496;">&quot;</span><span style="color:#657b83;">
    return </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">Ice</span><span style="color:#839496;">&quot;

</span><span style="color:#b58900;">main </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">main </span><span style="color:#859900;">= do</span><span style="color:#657b83;">
    origSword </span><span style="color:#859900;">&lt;-</span><span style="color:#657b83;"> killNedStark

    </span><span style="color:#859900;">let</span><span style="color:#657b83;"> (forTywin, forBrienne) </span><span style="color:#859900;">=</span><span style="color:#657b83;"> runState forge origSword

    putStrLn </span><span style="color:#859900;">$ </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">Tywin received: </span><span style="color:#839496;">&quot; </span><span style="color:#859900;">++</span><span style="color:#657b83;"> forTywin
    putStrLn </span><span style="color:#859900;">$ </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">Jaime gave Brienne: </span><span style="color:#839496;">&quot; </span><span style="color:#859900;">++</span><span style="color:#657b83;"> forBrienne
</span></code></pre>
<p>Not exactly justice, but the types have been satisfied! A monad always
pays its debts.</p>
<h2 id="throwing">Throwing</h2>
<p>Monads are also useful for dealing with exceptional cases:</p>
<pre style="background-color:#fdf6e3;">
<code><span style="color:#657b83;">#</span><span style="color:#859900;">!/</span><span style="color:#657b83;">usr</span><span style="color:#859900;">/</span><span style="color:#657b83;">bin</span><span style="color:#859900;">/</span><span style="color:#657b83;">env stack
</span><span style="color:#93a1a1;">-- stack --resolver lts-6.15 --install-ghc runghc

</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">Control.Exception
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">Data.Typeable </span><span style="color:#657b83;">(</span><span style="color:#268bd2;">Typeable</span><span style="color:#657b83;">)

</span><span style="color:#859900;">data </span><span style="color:#cb4b16;">JaimeException </span><span style="color:#859900;">= </span><span style="color:#cb4b16;">ThrowBranFromWindow
    </span><span style="color:#859900;">deriving</span><span style="color:#657b83;"> (</span><span style="color:#268bd2;">Show</span><span style="color:#657b83;">, </span><span style="color:#268bd2;">Typeable</span><span style="color:#657b83;">)
</span><span style="color:#859900;">instance </span><span style="color:#268bd2;">Exception JaimeException

</span><span style="color:#b58900;">jaime </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">jaime </span><span style="color:#859900;">= do</span><span style="color:#657b83;">
    putStrLn </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">Did anyone see us?</span><span style="color:#839496;">&quot;</span><span style="color:#657b83;">
    answer </span><span style="color:#859900;">&lt;-</span><span style="color:#657b83;"> getLine
    </span><span style="color:#859900;">if</span><span style="color:#657b83;"> answer </span><span style="color:#859900;">== </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">no</span><span style="color:#839496;">&quot;
        </span><span style="color:#859900;">then</span><span style="color:#657b83;"> putStrLn </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">Good</span><span style="color:#839496;">&quot;
        </span><span style="color:#859900;">else</span><span style="color:#657b83;"> throwIO </span><span style="color:#cb4b16;">ThrowBranFromWindow

</span><span style="color:#b58900;">main </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">main </span><span style="color:#859900;">=</span><span style="color:#657b83;"> jaime
</span></code></pre><h2 id="killing">Killing</h2>
<p>And thanks to asynchronous exceptions, you can also kill other threads
with monads.</p>
<pre style="background-color:#fdf6e3;">
<code><span style="color:#657b83;">#</span><span style="color:#859900;">!/</span><span style="color:#657b83;">usr</span><span style="color:#859900;">/</span><span style="color:#657b83;">bin</span><span style="color:#859900;">/</span><span style="color:#657b83;">env stack
</span><span style="color:#93a1a1;">-- stack --resolver lts-6.15 --install-ghc runghc

</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">Control.Concurrent
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">Control.Exception
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">Control.Monad
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">Data.Typeable </span><span style="color:#657b83;">(</span><span style="color:#268bd2;">Typeable</span><span style="color:#657b83;">)

</span><span style="color:#859900;">data </span><span style="color:#cb4b16;">JaimeException </span><span style="color:#859900;">= </span><span style="color:#cb4b16;">Defenestrate
    </span><span style="color:#859900;">deriving</span><span style="color:#657b83;"> (</span><span style="color:#268bd2;">Show</span><span style="color:#657b83;">, </span><span style="color:#268bd2;">Typeable</span><span style="color:#657b83;">)
</span><span style="color:#859900;">instance </span><span style="color:#268bd2;">Exception JaimeException

</span><span style="color:#b58900;">bran </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">bran </span><span style="color:#859900;">=</span><span style="color:#657b83;"> handle onErr </span><span style="color:#859900;">$</span><span style="color:#657b83;"> forever </span><span style="color:#859900;">$ do</span><span style="color:#657b83;">
    putStrLn </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">I&#39;m climbing a wall!</span><span style="color:#839496;">&quot;</span><span style="color:#657b83;">
    threadDelay </span><span style="color:#6c71c4;">100000
  </span><span style="color:#859900;">where
    </span><span style="color:#b58900;">onErr </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">SomeException </span><span style="color:#859900;">-&gt; </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">    onErr ex </span><span style="color:#859900;">=</span><span style="color:#657b83;"> putStrLn </span><span style="color:#859900;">$ </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">Oh no! I&#39;ve been killed by: </span><span style="color:#839496;">&quot; </span><span style="color:#859900;">++</span><span style="color:#657b83;"> show ex

</span><span style="color:#b58900;">jaime </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">ThreadId </span><span style="color:#859900;">-&gt; </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">jaime thread </span><span style="color:#859900;">= do</span><span style="color:#657b83;">
    threadDelay </span><span style="color:#6c71c4;">500000</span><span style="color:#657b83;">
    putStrLn </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">Oh, he saw us</span><span style="color:#839496;">&quot;</span><span style="color:#657b83;">
    throwTo thread </span><span style="color:#cb4b16;">Defenestrate</span><span style="color:#657b83;">
    threadDelay </span><span style="color:#6c71c4;">300000</span><span style="color:#657b83;">
    putStrLn </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">Problem solved</span><span style="color:#839496;">&quot;

</span><span style="color:#b58900;">main </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">main </span><span style="color:#859900;">= do</span><span style="color:#657b83;">
    thread </span><span style="color:#859900;">&lt;-</span><span style="color:#657b83;"> forkIO bran
    jaime thread
</span></code></pre>
<p>Exercise for the reader: modify <code>bran</code> so that he properly recovers
from that exception and begins warging instead. (WARNING:
<a href="https://haskell-lang.org/library/safe-exceptions">don't recover from async exceptions in practice</a>.)</p>
<h2 id="exiting">Exiting</h2>
<p>You can also exit your entire process with monads.</p>
<pre style="background-color:#fdf6e3;">
<code><span style="color:#657b83;">#</span><span style="color:#859900;">!/</span><span style="color:#657b83;">usr</span><span style="color:#859900;">/</span><span style="color:#657b83;">bin</span><span style="color:#859900;">/</span><span style="color:#657b83;">env stack
</span><span style="color:#93a1a1;">-- stack --resolver lts-6.15 --install-ghc runghc

</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">System.Exit

</span><span style="color:#b58900;">tommen </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">tommen </span><span style="color:#859900;">= do</span><span style="color:#657b83;">
    putStrLn </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">Oh, my dear wife!</span><span style="color:#839496;">&quot;</span><span style="color:#657b83;">
    exitFailure

</span><span style="color:#b58900;">main </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">main </span><span style="color:#859900;">=</span><span style="color:#657b83;"> tommen
</span></code></pre><h2 id="passing-the-baton-of-reign">Passing the baton of reign</h2>
<p>We've seen Lannisters pass the baton of reign from family member to family member. We've also seem them ruthlessly destroy holy insitutions and have their private, internal affairs exposed. As it turns out, we can do all of that with some explicit <a href="https://wiki.haskell.org/Evaluation_order_and_state_tokens">state token</a> manipulation!</p>
<pre style="background-color:#fdf6e3;">
<code><span style="color:#657b83;">#</span><span style="color:#859900;">!/</span><span style="color:#657b83;">usr</span><span style="color:#859900;">/</span><span style="color:#657b83;">bin</span><span style="color:#859900;">/</span><span style="color:#657b83;">env stack
</span><span style="color:#93a1a1;">-- stack --resolver lts-6.15 --install-ghc runghc

</span><span style="color:#b58900;">{-# </span><span style="color:#859900;">LANGUAGE</span><span style="color:#b58900;"> MagicHash #-}
{-# </span><span style="color:#859900;">LANGUAGE</span><span style="color:#b58900;"> UnboxedTuples #-}
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">GHC.Prim
</span><span style="color:#cb4b16;">import </span><span style="color:#859900;">GHC.Types

</span><span style="color:#b58900;">joffrey </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">joffrey </span><span style="color:#859900;">= do</span><span style="color:#657b83;">
    putStrLn </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">Look at your dead father&#39;s head Sansa!</span><span style="color:#839496;">&quot;</span><span style="color:#657b83;">
    putStrLn </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">Oh no, poisoned!</span><span style="color:#839496;">&quot;

</span><span style="color:#b58900;">tommen </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">tommen </span><span style="color:#859900;">= do</span><span style="color:#657b83;">
    putStrLn </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">I&#39;m in love!</span><span style="color:#839496;">&quot;</span><span style="color:#657b83;">
    putStrLn </span><span style="color:#839496;">&quot;</span><span style="color:#2aa198;">*Swan dive*</span><span style="color:#839496;">&quot;

</span><span style="color:#b58900;">cersei </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">cersei </span><span style="color:#859900;">=</span><span style="color:#657b83;"> undefined </span><span style="color:#93a1a1;">-- season 7 isn&#39;t out yet

</span><span style="color:#b58900;">unIO </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO a </span><span style="color:#859900;">-&gt; </span><span style="color:#268bd2;">State</span><span style="color:#657b83;"># </span><span style="color:#268bd2;">RealWorld </span><span style="color:#859900;">-&gt;</span><span style="color:#657b83;"> (# </span><span style="color:#268bd2;">State</span><span style="color:#657b83;"># </span><span style="color:#268bd2;">RealWorld</span><span style="color:#657b83;">, </span><span style="color:#268bd2;">a</span><span style="color:#657b83;"> #)
unIO (</span><span style="color:#cb4b16;">IO</span><span style="color:#657b83;"> f) </span><span style="color:#859900;">=</span><span style="color:#657b83;"> f

</span><span style="color:#b58900;">main </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">IO </span><span style="color:#859900;">()
</span><span style="color:#657b83;">main </span><span style="color:#859900;">= </span><span style="color:#cb4b16;">IO </span><span style="color:#859900;">$ \</span><span style="color:#657b83;">s0 </span><span style="color:#859900;">-&gt;
  case</span><span style="color:#657b83;"> unIO joffrey s0 </span><span style="color:#859900;">of</span><span style="color:#657b83;">
    (# s1, </span><span style="color:#b58900;">()</span><span style="color:#657b83;"> #) </span><span style="color:#859900;">-&gt;
      case</span><span style="color:#657b83;"> unIO tommen s1 </span><span style="color:#859900;">of</span><span style="color:#657b83;">
        (# s2, </span><span style="color:#b58900;">()</span><span style="color:#657b83;"> #) </span><span style="color:#859900;">-&gt;</span><span style="color:#657b83;">
          unIO cersei s2
</span></code></pre><h2 id="honorable-mentions">Honorable mentions</h2>
<p>There's much more to be done with this topic, and there were other
ideas besides Lannisters for this post. To give some mention for other
ideas:</p>
<ul>
<li>There's plenty of other Lannister material to work with (skinning
animals, Jaime and Cersei affairs, or Tyrion proclivities). But I
had to draw the line somewhere (both for length of post and topics I
felt like discussing...). Feel free to comment about other ideas.</li>
<li>One of my favorites: <a href="https://twitter.com/00Syssiphus/status/774240234766819332">monads are like onions</a></li>
<li>Monads are <a href="https://twitter.com/GabrielG439/status/774234282323697664">just your opinion, man</a></li>
<li>&quot;they're like Gargoyles, they decorate the public facing interface
of important landmarks in Haskell-land.&quot;
<a href="https://twitter.com/tritlo/status/774235047780032512">link</a></li>
</ul>
<p>Personally, I was going to go with a really terrible &quot;monads are like
printers&quot; based on them taking plain paper in and spitting out printed
pages, but Lannisters was a lot more fun. Also, I'm sure there's
<em>something</em> great to be done with presidential candidates, at the very
least <code>throwTo opponent Insult</code>.</p>
<h2 id="disclaimer">Disclaimer</h2>
<p>Since I'm sure <em>someone</em> is going to get upset about this: YES, this
post is meant entirely as parody, and should not be used for actually
learning anything except some random details of Game of Thrones, and
perhaps a bit of Haskell syntax. Please use the learning materials I
linked at the beginning for actually learning about Haskell and
monads. And my real advice: don't actually &quot;learn monads,&quot; just start
using Haskell and you'll pick them up naturally.</p>


<div class="text-center"><a href="/blog/" class="btn btn-primary">Read more blog posts</a></div>

      <div id="disqus_thread"></div>
      <script>
        (function() {var d = document, s = d.createElement('script'); s.src = '//snoyberg.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s);})();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<!--
    </div>

    <div class="col-lg-3" id="archive">
      <h3>Blog archive</h3>
      <ul class="blog-archive">
            $forall ((year, month, slug), post) <- posts
                <li>
                    <a href=@?{addPreview $ PostR year month slug}>#{postTitle post}
                    \ #
                    <i>#{prettyDay now (postTime post)}
-->

<div class="text-center"><a href="/blog/" class="btn btn-primary">Read more blog posts</a></div>


            </div>
          </div>
        </div>
      </section>
    </main>

    
<footer class="bg-dark py-5">
  <ul class="list-inline text-center text-md-right mb-0">
    <li class="list-inline-item mx-2">
      <a href="https://twitter.com/snoyberg">Follow @snoyberg</a>
    </li>
    <li class="list-inline-item mx-2">
      <a href="https://twitter.com/intent/tweet?screen_name=snoyberg">Tweet to @snoyberg</a>
    </li>
    <li class="list-inline-item mx-2">
      <a href="https://github.com/snoyberg">Github</a>
    </li>
    <li class="list-inline-item mx-2">
      <a href="https://tech.fpcomplete.com/">FP Complete</a>
    </li>
    <li class="list-inline-item mx-2">
      <a href="https://www.haskellers.com/user/snoyberg">I'm a Haskeller</a>
    </li>
  </ul>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1434510-21', 'auto');
  ga('send', 'pageview');
</script>

<!-- JS Script Files -->
<!-- Global Vendor -->
<script src="/maxi/vendors/jquery.min.js"></script>
<script src="/maxi/vendors/jquery.migrate.min.js"></script>
<script src="/maxi/vendors/popper.min.js"></script>
<script src="/maxi/vendors/bootstrap/js/bootstrap.min.js"></script>

<!-- Components Vendor  --> 
<script src="/maxi/contact/jqBootstrapValidation.js"></script>
<!--Plugin Initialize-->
<script src="/maxi/js/global.js"></script>
<!-- END JAVASCRIPTS -->


  </body>
</html>
