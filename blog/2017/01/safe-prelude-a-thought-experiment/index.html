
    

<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>safe-prelude: a thought experiment</title>

    <meta name="twitter:site" content="@snoyberg">
    <meta name="twitter:creator" content="@snoyberg">
    <meta name="og:site_name" content="Michael Snoyman's homepage">
    <meta name="og:title" content="safe-prelude: a thought experiment">
    <meta name="og:type content="website">

    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"> 
    <link rel="stylesheet" href="/maxi/vendors/font-awesome/css/fontawesome-all.min.css">
    <link rel="stylesheet" type="text/css" href="/maxi/css/styles.css">

    






    <link rel="openid2.provider" href="https://openid.stackexchange.com/openid/provider">
    <link rel="openid2.local_id" href="https://openid.stackexchange.com/user/d26546d2-46db-4099-83ca-e1eccfa0dd8d">
    <link href="/rss.xml" type="application/atom+xml" rel="alternate" title="Michael Snoyman's blog">

    <style>.wt-section { padding-top: 2rem }</style>
  <body>
    <header class="inner-page">
      

<nav class="js-navbar-scroll navbar fixed-top navbar-expand-lg">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">
      <img src="/img/snoylogo.png" height="50px">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo" aria-controls="navbarTogglerDemo" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse onCollapse" id="navbarTogglerDemo">
      <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="/blog">Blog</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://www.yesodweb.com/">Yesod</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="http://shop.oreilly.com/product/0636920035664.do">Yesod Book</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://www.beginrust.com/">Rust Book</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://www.youtube.com/c/snoyberg">YouTube</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://twitter.com/snoyberg">Twitter</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://github.com/snoyberg">Github</a>
        </li>
      </ul>
    </div>
  </div>
</nav>



      <section class="wt-section bg-gray text-center inner-page-header" style="padding-top:100px">
        <div class="container">
          <div class="row justify-content-md-center align-items-center text-white py-lg-5">
            <div class="col-md-7">
              <div class="text-center">
                <h1 class="display-sm-4 display-lg-3">safe-prelude: a thought experiment</h1>
                
<p class="h6 text-uppercase wt-letter-spacing-sm mb-0">Published January 16, 2017</p>

              </div>
            </div>
          </div>
        </div>
      </section>
    </header>

    <main role="main">
      <section class="wt-section">
        <div class="container">
          <div class="row justify-content-between">
            <div class="col-lg-12">
              <p class="text-center">
                <a class="btn" style="background: #72472f; color: #fff; font-weight: bold" href="https://www.beginrust.com/">New: The "Begin Rust" book</a>
              </p>

              




  


<div class="share-bar-wrapper">
  <div class="share-bar-inner">
    <b>Share this</b>
    <a target="_blank" href="https://twitter.com/intent/tweet?text=safe-prelude%3A%20a%20thought%20experiment https%3A&#x2F;&#x2F;www.snoyman.com&#x2F;blog&#x2F;2017&#x2F;01&#x2F;safe-prelude-a-thought-experiment&#x2F;" title="Share on Twitter">
      <i class="fab fa-twitter"></i>
    </a>

    <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A&#x2F;&#x2F;www.snoyman.com&#x2F;blog&#x2F;2017&#x2F;01&#x2F;safe-prelude-a-thought-experiment&#x2F;" title="Share on Facebook">
      <i class="fab fa-facebook"></i>
    </a>

    <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A&#x2F;&#x2F;www.snoyman.com&#x2F;blog&#x2F;2017&#x2F;01&#x2F;safe-prelude-a-thought-experiment&#x2F;&amp;title=safe-prelude%3A%20a%20thought%20experiment" title="Share on LinkedIn">
      <i class="fab fa-linkedin"></i>
    </a>

    <a target="_blank" href="https://www.reddit.com/submit?url=https%3A&#x2F;&#x2F;www.snoyman.com&#x2F;blog&#x2F;2017&#x2F;01&#x2F;safe-prelude-a-thought-experiment&#x2F;" title="Share on Reddit">
      <i class="fab fa-reddit"></i>
    </a>
  </div>
</div>



<!--
<div class="container" id="blog-body">
  <div class="row">
    <div class="col-lg-9">
-->
      <p>
        <i>
          See a typo? Have a suggestion?
          <a target="_blank" rel="nofollow" href="https://github.com/snoyberg/snoyman.com/edit/master/content/blog&#x2F;safe-prelude-a-thought-experiment.md">Edit this page on Github</a>
        </i>
      </p>

      <p>This blog post is to share a very rough first stab at a new prelude I
played around with earlier this month. I haven't used it in any
significant way, and haven't spent more than a few hours on it
total. I wrote it because I knew it was the only way to get the idea
out of my head, and am sharing it in case anyone finds the idea
intriguing or useful.</p>
<p>The project is available
<a href="https://github.com/snoyberg/safe-prelude#readme">on Github at snoyberg/safe-prelude</a>,
and I've
<a href="/static/safe-prelude/SafePrelude.html">uploaded the Haddocks for easier reading</a>
(though, be warned, they aren't well organized at all). The rest of
this post is just a copy of the <code>README.md</code> file for the project.</p>
<hr />
<p>This is a thought experiment in a different point in the alternative
prelude design space. After my
<a href="http://www.snoyman.com/blog/2016/12/beware-of-readfile">blog post on readFile</a>,
I realized I was unhappy with the polymorphic nature of <code>readFile</code> in
<a href="https://www.stackage.org/package/classy-prelude">classy-prelude</a>. Adding
that with
<a href="http://lorepub.com/post/2016-12-17-Haskell-Pitfalls">Haskell Pitfalls</a>
I've been itching to try something else. I have a lot of hope for the
<a href="https://github.com/haskell-foundation/foundation#readme">foundation project</a>,
but wanted to play with this in the short term.</p>
<h2 id="choices">Choices</h2>
<ul>
<li>
<p>No partial functions, period. If a function can fail, its return
type must express that. (And for our purposes: <code>IO</code> functions with
runtime exceptions are <em>not</em> partial.)</p>
</li>
<li>
<p>Choose best in class libraries and promote them. <code>bytestring</code> and
<code>text</code> fit that bill, as an example. Full listing below.</p>
</li>
<li>
<p>Regardless of the versions of underlying libraries, this package
will always export a consistent API, so that CPP usage should be
constrained to just inside this package.</p>
</li>
<li>
<p>Use generalization (via type classes) when they are well
established. For example: <code>Foldable</code> and <code>Traversable</code> yes,
<code>MonoFoldable</code> no.</p>
<ul>
<li>
<p><em>Controversial</em> Avoid providing list-specific functions. This
connects to the parent point. Most of the time, I'd argue that
lists are <em>not</em> the correct choice, and instead a <code>Vector</code>
should be used. There is no standard for sequence-like
typeclasses (though many exist), so we're not going to
generalize. But we're also not going to use a less efficient
representation.</p>
<p>I was torn on this, but decided in favor of leaving out
functions initially, on the basis that it's easier to add
something in later rather than remove it.</p>
</li>
</ul>
</li>
<li>
<p>Encourage qualified imports with a consistent naming scheme. This is
a strong departure from classy-prelude, which tried to make it
unnecessary to use qualified imports. I'll save my feelings about
qualified imports for another time, this is just a pragmatic choice
given the other constraints.</p>
</li>
<li>
<p>Export any non-conflicting and not-discouraged names from this
module that make sense, e.g. <code>ByteString</code>, <code>Text</code>, or <code>readIORef</code>.</p>
</li>
</ul>
<h2 id="libraries">Libraries</h2>
<p>This list may fall out of date, so check the <code>.cabal</code> file for a
current and complete listing. I'm keeping this here to include
reasoning for some libraries:</p>
<ul>
<li><code>bytestring</code> and <code>text</code>, despite some complaints, are clearly the
most popular representation for binary and textual data,
respectively</li>
<li><code>containers</code> and <code>unordered-containers</code> are both commonly used. Due
to lack of generalization, this library doesn't expose any functions
for working with their types, but they are common enough that adding
the dependency just for exposing the type name is worth it</li>
<li><code>safe-exceptions</code> hides the complexity of asynchronous exceptions,
and should be used in place of <code>Control.Exception</code></li>
<li><code>transformers</code> and <code>mtl</code> are clear winners in the monad transformer
space, at least for now</li>
<li>While young, <code>say</code> has been very useful for me in avoiding
interleaved output issues</li>
<li>Others without real competitors: <code>deepseq</code>, <code>semigroups</code></li>
</ul>
<p>Packages I considered but have not included yet:</p>
<ul>
<li>
<p><code>stm</code> is an obvious winner, and while I use it constantly, I'm not
convinced everyone else uses it as much as I do. Also, there are some
questions around generalizing its functions (e.g., <code>atomically</code> could
be in <code>MonadIO</code>), and I don't want to make that decision yet.</p>
<ul>
<li><code>stm-chans</code> falls into this category too</li>
</ul>
</li>
<li>
<p><code>async</code> is an amazing library, and in particular the <code>race</code>,
<code>concurrently</code>, and <code>Concurrently</code> bits are an easy win. I've left
it out for now due to questions of generalizing to
<code>MonadBaseControl</code> (see <code>lifted-async</code> and its <code>.Safe</code> module)</p>
</li>
<li>
<p>Similar argument applies to <code>monad-unlift</code></p>
</li>
<li>
<p>I didn't bother with exposing the <code>Vector</code> type... because which one
would I expose? The <code>Vector</code> typeclass? Boxed <code>Vector</code>? Unboxed? I
could do the classy-prelude thing and define <code>type UVector = Data.Vector.Unboxed.Vector</code>, but I'd rather not do such renamings.</p>
</li>
</ul>
<h2 id="qualified-imports">Qualified imports</h2>
<p>Here are the recommend qualified imports when working with safe-prelude.</p>
<pre style="background-color:#fdf6e3;">
<code><span style="color:#cb4b16;">import qualified</span><span style="color:#657b83;"> &quot;bytestring&quot; </span><span style="color:#859900;">Data.ByteString </span><span style="color:#cb4b16;">as </span><span style="color:#859900;">B
</span><span style="color:#cb4b16;">import qualified</span><span style="color:#657b83;"> &quot;bytestring&quot; </span><span style="color:#859900;">Data.ByteString.Lazy </span><span style="color:#cb4b16;">as </span><span style="color:#859900;">BL
</span><span style="color:#cb4b16;">import qualified</span><span style="color:#657b83;"> &quot;text&quot; </span><span style="color:#859900;">Data.Text </span><span style="color:#cb4b16;">as </span><span style="color:#859900;">T
</span><span style="color:#cb4b16;">import qualified</span><span style="color:#657b83;"> &quot;text&quot; </span><span style="color:#859900;">Data.Text.Lazy </span><span style="color:#cb4b16;">as </span><span style="color:#859900;">TL
</span><span style="color:#cb4b16;">import qualified</span><span style="color:#657b83;"> &quot;containers&quot; </span><span style="color:#859900;">Data.Map.Strict </span><span style="color:#cb4b16;">as </span><span style="color:#859900;">Map
</span><span style="color:#cb4b16;">import qualified</span><span style="color:#657b83;"> &quot;containers&quot; </span><span style="color:#859900;">Data.Set </span><span style="color:#cb4b16;">as </span><span style="color:#859900;">Set
</span><span style="color:#cb4b16;">import qualified</span><span style="color:#657b83;"> &quot;unordered-containers&quot; </span><span style="color:#859900;">Data.HashMap.Strict </span><span style="color:#cb4b16;">as </span><span style="color:#859900;">HashMap
</span><span style="color:#cb4b16;">import qualified</span><span style="color:#657b83;"> &quot;unordered-containers&quot; </span><span style="color:#859900;">Data.HashSet </span><span style="color:#cb4b16;">as </span><span style="color:#859900;">HashSet
</span></code></pre>

<div class="text-center"><a href="/blog/" class="btn btn-primary">Read more blog posts</a></div>

      <div id="disqus_thread"></div>
      <script>
        (function() {var d = document, s = d.createElement('script'); s.src = '//snoyberg.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s);})();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<!--
    </div>

    <div class="col-lg-3" id="archive">
      <h3>Blog archive</h3>
      <ul class="blog-archive">
            $forall ((year, month, slug), post) <- posts
                <li>
                    <a href=@?{addPreview $ PostR year month slug}>#{postTitle post}
                    \ #
                    <i>#{prettyDay now (postTime post)}
-->

<div class="text-center"><a href="/blog/" class="btn btn-primary">Read more blog posts</a></div>


            </div>
          </div>
        </div>
      </section>
    </main>

    
<footer class="bg-dark py-5">
  <ul class="list-inline text-center text-md-right mb-0">
    <li class="list-inline-item mx-2">
      <a href="https://twitter.com/snoyberg">Follow @snoyberg</a>
    </li>
    <li class="list-inline-item mx-2">
      <a href="https://twitter.com/intent/tweet?screen_name=snoyberg">Tweet to @snoyberg</a>
    </li>
    <li class="list-inline-item mx-2">
      <a href="https://github.com/snoyberg">Github</a>
    </li>
    <li class="list-inline-item mx-2">
      <a href="https://tech.fpcomplete.com/">FP Complete</a>
    </li>
    <li class="list-inline-item mx-2">
      <a href="https://www.haskellers.com/user/snoyberg">I'm a Haskeller</a>
    </li>
  </ul>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1434510-21', 'auto');
  ga('send', 'pageview');
</script>

<!-- JS Script Files -->
<!-- Global Vendor -->
<script src="/maxi/vendors/jquery.min.js"></script>
<script src="/maxi/vendors/jquery.migrate.min.js"></script>
<script src="/maxi/vendors/popper.min.js"></script>
<script src="/maxi/vendors/bootstrap/js/bootstrap.min.js"></script>

<!-- Components Vendor  --> 
<script src="/maxi/contact/jqBootstrapValidation.js"></script>
<!--Plugin Initialize-->
<script src="/maxi/js/global.js"></script>
<!-- END JAVASCRIPTS -->


  </body>
</html>
