
    

<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>Generalizing Type Signatures</title>

    <meta name="twitter:site" content="@snoyberg">
    <meta name="twitter:creator" content="@snoyberg">
    <meta name="og:site_name" content="Michael Snoyman's homepage">
    <meta name="og:title" content="Generalizing Type Signatures">
    <meta name="og:type content="website">

    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"> 
    <link rel="stylesheet" href="/maxi/vendors/font-awesome/css/fontawesome-all.min.css">
    <link rel="stylesheet" type="text/css" href="/maxi/css/styles.css">

    






    <link rel="openid2.provider" href="https://openid.stackexchange.com/openid/provider">
    <link rel="openid2.local_id" href="https://openid.stackexchange.com/user/d26546d2-46db-4099-83ca-e1eccfa0dd8d">
    <link href="/rss.xml" type="application/atom+xml" rel="alternate" title="Michael Snoyman's blog">

    <style>.wt-section { padding-top: 2rem }</style>
  <body>
    <header class="inner-page">
      

<nav class="js-navbar-scroll navbar fixed-top navbar-expand-lg">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">
      <img src="/img/snoylogo.png" height="50px">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo" aria-controls="navbarTogglerDemo" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse onCollapse" id="navbarTogglerDemo">
      <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="/blog">Blog</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://www.yesodweb.com/">Yesod</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="http://shop.oreilly.com/product/0636920035664.do">Yesod Book</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://www.beginrust.com/">Rust Book</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://www.youtube.com/c/snoyberg">YouTube</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://twitter.com/snoyberg">Twitter</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://github.com/snoyberg">Github</a>
        </li>
      </ul>
    </div>
  </div>
</nav>



      <section class="wt-section bg-gray text-center inner-page-header" style="padding-top:100px">
        <div class="container">
          <div class="row justify-content-md-center align-items-center text-white py-lg-5">
            <div class="col-md-7">
              <div class="text-center">
                <h1 class="display-sm-4 display-lg-3">Generalizing Type Signatures</h1>
                
<p class="h6 text-uppercase wt-letter-spacing-sm mb-0">Published April 20, 2017</p>

              </div>
            </div>
          </div>
        </div>
      </section>
    </header>

    <main role="main">
      <section class="wt-section">
        <div class="container">
          <div class="row justify-content-between">
            <div class="col-lg-12">
              <p class="text-center">
                <a class="btn" style="background: #72472f; color: #fff; font-weight: bold" href="https://www.beginrust.com/">New: The "Begin Rust" book</a>
              </p>

              




  


<div class="share-bar-wrapper">
  <div class="share-bar-inner">
    <b>Share this</b>
    <a target="_blank" href="https://twitter.com/intent/tweet?text=Generalizing%20Type%20Signatures https%3A&#x2F;&#x2F;www.snoyman.com&#x2F;blog&#x2F;2017&#x2F;04&#x2F;generalizing-type-signatures&#x2F;" title="Share on Twitter">
      <i class="fab fa-twitter"></i>
    </a>

    <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A&#x2F;&#x2F;www.snoyman.com&#x2F;blog&#x2F;2017&#x2F;04&#x2F;generalizing-type-signatures&#x2F;" title="Share on Facebook">
      <i class="fab fa-facebook"></i>
    </a>

    <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A&#x2F;&#x2F;www.snoyman.com&#x2F;blog&#x2F;2017&#x2F;04&#x2F;generalizing-type-signatures&#x2F;&amp;title=Generalizing%20Type%20Signatures" title="Share on LinkedIn">
      <i class="fab fa-linkedin"></i>
    </a>

    <a target="_blank" href="https://www.reddit.com/submit?url=https%3A&#x2F;&#x2F;www.snoyman.com&#x2F;blog&#x2F;2017&#x2F;04&#x2F;generalizing-type-signatures&#x2F;" title="Share on Reddit">
      <i class="fab fa-reddit"></i>
    </a>
  </div>
</div>



<!--
<div class="container" id="blog-body">
  <div class="row">
    <div class="col-lg-9">
-->
      <p>
        <i>
          See a typo? Have a suggestion?
          <a target="_blank" rel="nofollow" href="https://github.com/snoyberg/snoyman.com/edit/master/content/blog&#x2F;generalizing-type-signatures.md">Edit this page on Github</a>
        </i>
      </p>

      <p>In each of the following, which is the best version of the type
signature (assume <code>Monad m</code> context)?</p>
<pre style="background-color:#fdf6e3;">
<code><span style="color:#b58900;">when </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">Bool </span><span style="color:#859900;">-&gt; </span><span style="color:#268bd2;">m </span><span style="color:#859900;">() -&gt; </span><span style="color:#268bd2;">m </span><span style="color:#859900;">()
</span><span style="color:#b58900;">when </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">Bool </span><span style="color:#859900;">-&gt; </span><span style="color:#268bd2;">m a  </span><span style="color:#859900;">-&gt; </span><span style="color:#268bd2;">m </span><span style="color:#859900;">()

</span><span style="color:#b58900;">mapM_ </span><span style="color:#859900;">::</span><span style="color:#657b83;"> (</span><span style="color:#268bd2;">a </span><span style="color:#859900;">-&gt; </span><span style="color:#268bd2;">m </span><span style="color:#859900;">()</span><span style="color:#657b83;">) </span><span style="color:#859900;">-&gt;</span><span style="color:#657b83;"> [</span><span style="color:#268bd2;">a</span><span style="color:#657b83;">] </span><span style="color:#859900;">-&gt; </span><span style="color:#268bd2;">m </span><span style="color:#859900;">()
</span><span style="color:#b58900;">mapM_ </span><span style="color:#859900;">::</span><span style="color:#657b83;"> (</span><span style="color:#268bd2;">a </span><span style="color:#859900;">-&gt; </span><span style="color:#268bd2;">m b</span><span style="color:#657b83;">)  </span><span style="color:#859900;">-&gt;</span><span style="color:#657b83;"> [</span><span style="color:#268bd2;">a</span><span style="color:#657b83;">] </span><span style="color:#859900;">-&gt; </span><span style="color:#268bd2;">m </span><span style="color:#859900;">()

</span><span style="color:#b58900;">runConduit </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">ConduitM </span><span style="color:#859900;">() </span><span style="color:#268bd2;">Void m r </span><span style="color:#859900;">-&gt; </span><span style="color:#268bd2;">m r
</span><span style="color:#b58900;">runConduit </span><span style="color:#859900;">:: </span><span style="color:#268bd2;">ConduitM i  o    m r </span><span style="color:#859900;">-&gt; </span><span style="color:#268bd2;">m r
</span></code></pre>
<p>In each of these cases, the second, more generalized version of the
signature can easily be provided, but the question is, should it be? I
know of the following arguments:</p>
<p>Pro generalized:</p>
<ul>
<li>Why would we artificially limit the generality of our functions?</li>
<li>Having to sprinkle a bunch of <code>void</code>s around is a code smell</li>
</ul>
<p>Against generalized:</p>
<ul>
<li>It can allow accidental bugs to slip in by unintentionally ignoring
values</li>
<li>In some cases, the generalized version has
<a href="http://www.snoyman.com/blog/2017/01/foldable-mapm-maybe-and-recursive-functions">worse performance</a></li>
</ul>
<p>I don't think these points bring anything new to the table: it seems
to me that these trade-offs are fairly well understood, even if not
talked about explicitly often. The other thing I'd observe is that,
ignoring the issue of performance, this is just a rehashing of the
much more general argument of explicit vs implicit. We can all
acknowledge that with liberal application of <code>void</code> and similar
functions, it's always possible to rewrite code relying on the
generalized version to use the specialized version. The question comes
down to that annoying need for throwing in <code>void</code>.</p>
<p>How do we determine whether we should use generalized or specialized
functions? I'm starting to follow this procedure:</p>
<ol>
<li>If there's a performance concern, let that take precedence. Having
accidentally slower code due to a desire to make code shorter/more
beautiful is a bad trade-off.</li>
<li>If there's no performance issue (like with <code>runConduit</code>), it's a
completely subjective decision. The facts I'd look for are examples
of bugs people run into with the generalized version.</li>
</ol>
<p>On the bug front, I think it's important to point out that, in my
experience, the bugs are less likely to appear during initial code
writing, but during code review and refactoring. When you write
something like <code>when foo getLine</code>, you've probably gone through the
thought process &quot;I'm just trying to give the user a chance to hit
&lt;ENTER&gt;, and I'm intentionally ignoring whatever the user entered.&quot;
But during refactoring that may not be so obvious, and some ignored
user input may be surpring. By contrast, <code>when foo (void getLine)</code>
stands out more blatantly.</p>
<p>Finally, in comparing this to the general discussion of explicit vs implicit, I want to point out that there's no &quot;one right answer&quot; here. This falls into the same category of &quot;do I define a typeclass/interface?&quot;, which is always a judgement call. You can give general guidelines, but I think we can all agree that both extremes:</p>
<ul>
<li>Never define a typeclass for any purpose</li>
<li>Define every single function to be a member of a typeclass</li>
</ul>
<p>Are ridiculous oversimplifications that we should not advocate. Same
thing applies here: there are times when a generalized type signature
makes sense, and times when it doesn't.</p>
<h2 id="conduit">Conduit</h2>
<p>As an aside, if anyone is wondering where this random blog post came
from, while working on a presentation on Conduit and Yesod, I
revisited
<a href="https://github.com/snoyberg/conduit/issues/283">an issue from a few months ago</a>
about deprecating older type synonyms
(<a href="https://github.com/snoyberg/conduit/pull/307">PR now available</a>),
and was reminded of the ongoing debate around which of the following
is the correct <code>runConduit</code> signature:</p>
<pre style="background-color:#fdf6e3;">
<code><span style="color:#6c71c4;">1</span><span style="color:#859900;">: </span><span style="color:#cb4b16;">ConduitM </span><span style="color:#b58900;">()   </span><span style="color:#cb4b16;">Void</span><span style="color:#657b83;"> m r </span><span style="color:#859900;">-&gt;</span><span style="color:#657b83;"> m r </span><span style="color:#93a1a1;">-- today
</span><span style="color:#6c71c4;">2</span><span style="color:#859900;">: </span><span style="color:#cb4b16;">ConduitM</span><span style="color:#657b83;"> i    o    m r </span><span style="color:#859900;">-&gt;</span><span style="color:#657b83;"> m r </span><span style="color:#93a1a1;">-- most general
</span><span style="color:#6c71c4;">3</span><span style="color:#859900;">: </span><span style="color:#cb4b16;">ConduitM Void Void</span><span style="color:#657b83;"> m r </span><span style="color:#859900;">-&gt;</span><span style="color:#657b83;"> m r </span><span style="color:#93a1a1;">-- standardize on Void
</span><span style="color:#6c71c4;">4</span><span style="color:#859900;">: </span><span style="color:#cb4b16;">ConduitM </span><span style="color:#b58900;">()   ()</span><span style="color:#657b83;">   m r </span><span style="color:#859900;">-&gt;</span><span style="color:#657b83;"> m r </span><span style="color:#93a1a1;">-- standardize on unit
</span></code></pre>
<p>The current situation of <code>()</code> for input and <code>Void</code> for output has been
around for a while, and originated with discussions around the
conduit/pipes dichotomy. (And in fact,
<a href="https://www.stackage.org/haddock/lts-8.11/pipes-4.3.2/Pipes.html#t:Effect">pipes today has the same split</a>.)
I'm not convinced that the split between input and output is a great
thing, so the arguments in favor of each of these signatures seem to
be:</p>
<ol>
<li>Backwards compatibility</li>
<li>Generalize, avoiding any need for explicit conversion ever, and
avoid the <code>()</code>/<code>Void</code> debate entirely
<ul>
<li>Note that we won't <em>really</em> avoid the debate entirely, since
other parts of conduit will still need to indicate &quot;nothing
upstream&quot; or &quot;nothing downstream&quot;</li>
</ul>
</li>
<li>Most explicit about what we're doing: we guarantee that there will
never be any real values yielded from upstream, or yielded
downstream. You can look through the conduit codebase for usages of
<code>absurd</code> to see this play out.</li>
<li>More explicit, but less cognitive overhead of learning about
<code>Void</code>.</li>
</ol>
<p>I think for now I'm leaning towards (1), as backwards compat has been
a big guiding principle for me, but the debate is still raging for me.</p>


<div class="text-center"><a href="/blog/" class="btn btn-primary">Read more blog posts</a></div>

      <div id="disqus_thread"></div>
      <script>
        (function() {var d = document, s = d.createElement('script'); s.src = '//snoyberg.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s);})();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<!--
    </div>

    <div class="col-lg-3" id="archive">
      <h3>Blog archive</h3>
      <ul class="blog-archive">
            $forall ((year, month, slug), post) <- posts
                <li>
                    <a href=@?{addPreview $ PostR year month slug}>#{postTitle post}
                    \ #
                    <i>#{prettyDay now (postTime post)}
-->

<div class="text-center"><a href="/blog/" class="btn btn-primary">Read more blog posts</a></div>


            </div>
          </div>
        </div>
      </section>
    </main>

    
<footer class="bg-dark py-5">
  <ul class="list-inline text-center text-md-right mb-0">
    <li class="list-inline-item mx-2">
      <a href="https://twitter.com/snoyberg">Follow @snoyberg</a>
    </li>
    <li class="list-inline-item mx-2">
      <a href="https://twitter.com/intent/tweet?screen_name=snoyberg">Tweet to @snoyberg</a>
    </li>
    <li class="list-inline-item mx-2">
      <a href="https://github.com/snoyberg">Github</a>
    </li>
    <li class="list-inline-item mx-2">
      <a href="https://tech.fpcomplete.com/">FP Complete</a>
    </li>
    <li class="list-inline-item mx-2">
      <a href="https://www.haskellers.com/user/snoyberg">I'm a Haskeller</a>
    </li>
  </ul>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1434510-21', 'auto');
  ga('send', 'pageview');
</script>

<!-- JS Script Files -->
<!-- Global Vendor -->
<script src="/maxi/vendors/jquery.min.js"></script>
<script src="/maxi/vendors/jquery.migrate.min.js"></script>
<script src="/maxi/vendors/popper.min.js"></script>
<script src="/maxi/vendors/bootstrap/js/bootstrap.min.js"></script>

<!-- Components Vendor  --> 
<script src="/maxi/contact/jqBootstrapValidation.js"></script>
<!--Plugin Initialize-->
<script src="/maxi/js/global.js"></script>
<!-- END JAVASCRIPTS -->


  </body>
</html>
