
    

<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <title>The Conduitpocalypse</title>

    <meta name="twitter:site" content="@snoyberg">
    <meta name="twitter:creator" content="@snoyberg">
    <meta name="og:site_name" content="Michael Snoyman's homepage">
    <meta name="og:title" content="The Conduitpocalypse">
    <meta name="og:type content="website">

    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"> 
    <link rel="stylesheet" href="/maxi/vendors/font-awesome/css/fontawesome-all.min.css">
    <link rel="stylesheet" type="text/css" href="/maxi/css/styles.css">

    

<meta name="og:description" value="Announcing a bunch of breaking library releases">






    <link rel="openid2.provider" href="https://openid.stackexchange.com/openid/provider">
    <link rel="openid2.local_id" href="https://openid.stackexchange.com/user/d26546d2-46db-4099-83ca-e1eccfa0dd8d">
    <link href="/rss.xml" type="application/atom+xml" rel="alternate" title="Michael Snoyman's blog">

    <style>.wt-section { padding-top: 2rem }</style>
  <body>
    <header class="inner-page">
      

<nav class="js-navbar-scroll navbar fixed-top navbar-expand-lg">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">
      <img src="/img/snoylogo.png" height="50px">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo" aria-controls="navbarTogglerDemo" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fas fa-bars"></i>
    </button>
    <div class="collapse navbar-collapse onCollapse" id="navbarTogglerDemo">
      <ul class="navbar-nav ml-auto mt-2 mt-lg-0">
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="/blog">Blog</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://www.yesodweb.com/">Yesod</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="http://shop.oreilly.com/product/0636920035664.do">Yesod Book</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://www.beginrust.com/">Rust Book</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://www.youtube.com/c/snoyberg">YouTube</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://twitter.com/snoyberg">Twitter</a>
        </li>
        <li class="nav-item mr-4 mb-2 mb-lg-0">
          <a class="nav-link" href="https://github.com/snoyberg">Github</a>
        </li>
      </ul>
    </div>
  </div>
</nav>



      <section class="wt-section bg-gray text-center inner-page-header" style="padding-top:100px">
        <div class="container">
          <div class="row justify-content-md-center align-items-center text-white py-lg-5">
            <div class="col-md-7">
              <div class="text-center">
                <h1 class="display-sm-4 display-lg-3">The Conduitpocalypse</h1>
                
<p class="h6 text-uppercase wt-letter-spacing-sm mb-0">Published February  4, 2018</p>

              </div>
            </div>
          </div>
        </div>
      </section>
    </header>

    <main role="main">
      <section class="wt-section">
        <div class="container">
          <div class="row justify-content-between">
            <div class="col-lg-12">
              <p class="text-center">
                <a class="btn" style="background: #72472f; color: #fff; font-weight: bold" href="https://www.beginrust.com/">New: The "Begin Rust" book</a>
              </p>

              




  


<div class="share-bar-wrapper">
  <div class="share-bar-inner">
    <b>Share this</b>
    <a target="_blank" href="https://twitter.com/intent/tweet?text=The%20Conduitpocalypse https%3A&#x2F;&#x2F;www.snoyman.com&#x2F;blog&#x2F;2018&#x2F;02&#x2F;conduitpocalypse&#x2F;" title="Share on Twitter">
      <i class="fab fa-twitter"></i>
    </a>

    <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A&#x2F;&#x2F;www.snoyman.com&#x2F;blog&#x2F;2018&#x2F;02&#x2F;conduitpocalypse&#x2F;" title="Share on Facebook">
      <i class="fab fa-facebook"></i>
    </a>

    <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A&#x2F;&#x2F;www.snoyman.com&#x2F;blog&#x2F;2018&#x2F;02&#x2F;conduitpocalypse&#x2F;&amp;title=The%20Conduitpocalypse" title="Share on LinkedIn">
      <i class="fab fa-linkedin"></i>
    </a>

    <a target="_blank" href="https://www.reddit.com/submit?url=https%3A&#x2F;&#x2F;www.snoyman.com&#x2F;blog&#x2F;2018&#x2F;02&#x2F;conduitpocalypse&#x2F;" title="Share on Reddit">
      <i class="fab fa-reddit"></i>
    </a>
  </div>
</div>



<!--
<div class="container" id="blog-body">
  <div class="row">
    <div class="col-lg-9">
-->
      <p>
        <i>
          See a typo? Have a suggestion?
          <a target="_blank" rel="nofollow" href="https://github.com/snoyberg/snoyman.com/edit/master/content/blog&#x2F;conduitpocalypse.md">Edit this page on Github</a>
        </i>
      </p>

      <p>At the end of last week, I made a number of breaking releases of
libraries. The API impact of these changes was relatively minor, so
most code should continue to work with little to no modification. I'm
going to call out the major motivating changes for these releases
below. If I leave out a package from explanations, assume the reason
is just &quot;upstream breaking changes caused breaking changes here.&quot; And
of course check the relevant ChangeLogs for more details.</p>
<p>For completeness, the list of packages I released at the end of last
week is:</p>
<ul>
<li>conduit-1.3.0</li>
<li>conduit-extra-1.3.0</li>
<li>network-conduit-tls-1.3.0</li>
<li>resourcet-1.2.0</li>
<li>xml-conduit-1.8.0</li>
<li>html-conduit-1.3.0</li>
<li>xml-hamlet-0.5.0</li>
<li>persistent-2.8.0</li>
<li>persistent-mongoDB-2.8.0</li>
<li>persistent-mysql-2.8.0</li>
<li>persistent-postgresql-2.8.0</li>
<li>persistent-sqlite-2.8.0</li>
<li>persistent-template-2.5.3.1</li>
<li>persistent-test-2.0.0.3</li>
<li>conduit-combinators-1.3.0</li>
<li>yesod-1.6.0</li>
<li>yesod-auth-1.6.0</li>
<li>yesod-auth-oauth-1.6.0</li>
<li>yesod-bin-1.6.0</li>
<li>yesod-core-1.6.0</li>
<li>yesod-eventsource-1.6.0</li>
<li>yesod-form-1.6.0</li>
<li>yesod-newsfeed-1.6.1.0</li>
<li>yesod-persistent-1.6.0</li>
<li>yesod-sitemap-1.6.0</li>
<li>yesod-static-1.6.0</li>
<li>yesod-test-1.6.0</li>
<li>yesod-websockets-0.3.0</li>
<li>classy-prelude-1.4.0</li>
<li>classy-prelude-conduit-1.4.0</li>
<li>classy-prelude-yesod-1.4.0</li>
<li>mutable-containers-0.3.4</li>
</ul>
<h2 id="switching-to-monadunliftio">Switching to MonadUnliftIO</h2>
<p>The primary instigator for this set of releases was moving my
libraries over from <code>MonadBaseControl</code> and <code>MonadCatch</code>/<code>MonadMask</code>
(from the <code>monad-control</code> and <code>exceptions</code> packages, respectively)
over to <code>MonadUnliftIO</code>. I
<a href="https://www.youtube.com/watch?v=KZIN9f9rI34">gave a talk recently</a>
(<a href="https://www.snoyman.com/reveal/monad-transformer-state">slides</a>) at
LambdaWorld about this topic, and have
<a href="https://www.fpcomplete.com/blog/2017/07/announcing-new-unliftio-library">blogged</a>
<a href="https://www.fpcomplete.com/blog/2017/07/the-rio-monad">at</a>
<a href="https://www.fpcomplete.com/blog/2017/06/readert-design-pattern">length</a>
<a href="https://www.fpcomplete.com/blog/2017/06/tale-of-two-brackets">as well</a>.
Therefore, I'm not going to get into the arguments here of why I think
<code>MonadUnliftIO</code> is a better solution to this class of problems.</p>
<p>Unless I missed something, this change dropped direct dependency on
the <code>monad-control</code>, <code>lifted-base</code>, and <code>lifted-async</code> packages
throughout all of the packages listed above. The dependency on the
<code>exceptions</code> package remains, but only for using the <code>MonadThrow</code>
typeclass, not the <code>MonadCatch</code> and <code>MonadMask</code> typeclasses. (This
does leave open a question of whether we should still define valid
instances of <code>MonadCatch</code> and <code>MonadMask</code>, see
<a href="https://github.com/commercialhaskell/rio/issues/38">rio issue #38</a>.)</p>
<p><strong>User impact</strong>: You may need to switch some usages of the
<code>lifted-base</code> package to <code>unliftio</code> or similar, and update some type
signatures. It's possible that if you're using a monad transformer
stack which is not an instance of <code>MonadUnliftIO</code> that you'll face
compilation issues.</p>
<h2 id="safer-runresourcet">Safer runResourceT</h2>
<p>In previous versions of the <code>resourcet</code> package, if you register a
cleanup action which throws an exception itself, the exception would
be swallowed. In this new release, any exceptions thrown during
cleanup will be rethrown by <code>runResourceT</code>.</p>
<h2 id="conduit-cleanups">conduit cleanups</h2>
<p>There were some big-ish changes to conduit:</p>
<ul>
<li>Drop finalizers from the library,
<a href="https://www.snoyman.com/blog/2018/01/drop-conduits-finalizers">as discussed previously</a>. This
resulted in the removal of the <code>yieldOr</code> and <code>addCleanup</code> functions,
and the replacement of the <code>ResumableSource</code> and <code>ResumableConduit</code>
types with the <code>SealedConduitT</code> type.</li>
<li>Deprecated the old type synonyms and operators from the
library. This has been
<a href="https://www.snoyman.com/blog/2016/09/proposed-conduit-reskin">planned for a long time</a>.</li>
<li>Moved the <code>Conduit</code> and <code>Data.Conduit.Combinators</code> modules from
<code>conduit-combinators</code> into <code>conduit</code> itself. This increases the
dependency footprint of conduit itself, but makes it a fully loaded
streaming data library. <code>conduit-combinators</code> is now an empty
library.</li>
</ul>
<h2 id="yesod-no-more-transformers">Yesod: no more transformers!</h2>
<p>The changes mentioned in
<a href="https://www.yesodweb.com/blog/2018/01/upcoming-yesod-breaking-changes">my last yesodweb.com blog post</a>
have been carried out. The biggest impact of that is replacing
<code>HandlerT</code> and <code>WidgetT</code> (as transformers over <code>IO</code>) with <code>HandlerFor</code>
and <code>WidgetFor</code>, as concrete monads parameterized by the site data
type. Thanks to backwards compat <code>HandlerT</code> and <code>WidgetT</code> type
synonyms, and the Template Haskell-generated <code>Handler</code> and <code>Widget</code>
synonyms being updated automatically, hopefully most users will feel
almost no impact from this. (Authors of subsites, however, will likely
have a more significant amount of work to do.)</p>
<h2 id="that-s-it">That's it?</h2>
<p>Yeah, this post turned out much smaller than I expected. There are
likely breakages that I've forgotten about and which should be called
out. I'll ask that if anyone notices particular breakages they needed
to work around, to please either include a note below or send a PR to
this blog post (link above) adding information on the change.</p>


<div class="text-center"><a href="/blog/" class="btn btn-primary">Read more blog posts</a></div>

      <div id="disqus_thread"></div>
      <script>
        (function() {var d = document, s = d.createElement('script'); s.src = '//snoyberg.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s);})();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<!--
    </div>

    <div class="col-lg-3" id="archive">
      <h3>Blog archive</h3>
      <ul class="blog-archive">
            $forall ((year, month, slug), post) <- posts
                <li>
                    <a href=@?{addPreview $ PostR year month slug}>#{postTitle post}
                    \ #
                    <i>#{prettyDay now (postTime post)}
-->

<div class="text-center"><a href="/blog/" class="btn btn-primary">Read more blog posts</a></div>


            </div>
          </div>
        </div>
      </section>
    </main>

    
<footer class="bg-dark py-5">
  <ul class="list-inline text-center text-md-right mb-0">
    <li class="list-inline-item mx-2">
      <a href="https://twitter.com/snoyberg">Follow @snoyberg</a>
    </li>
    <li class="list-inline-item mx-2">
      <a href="https://twitter.com/intent/tweet?screen_name=snoyberg">Tweet to @snoyberg</a>
    </li>
    <li class="list-inline-item mx-2">
      <a href="https://github.com/snoyberg">Github</a>
    </li>
    <li class="list-inline-item mx-2">
      <a href="https://tech.fpcomplete.com/">FP Complete</a>
    </li>
    <li class="list-inline-item mx-2">
      <a href="https://www.haskellers.com/user/snoyberg">I'm a Haskeller</a>
    </li>
  </ul>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-1434510-21', 'auto');
  ga('send', 'pageview');
</script>

<!-- JS Script Files -->
<!-- Global Vendor -->
<script src="/maxi/vendors/jquery.min.js"></script>
<script src="/maxi/vendors/jquery.migrate.min.js"></script>
<script src="/maxi/vendors/popper.min.js"></script>
<script src="/maxi/vendors/bootstrap/js/bootstrap.min.js"></script>

<!-- Components Vendor  --> 
<script src="/maxi/contact/jqBootstrapValidation.js"></script>
<!--Plugin Initialize-->
<script src="/maxi/js/global.js"></script>
<!-- END JAVASCRIPTS -->


  </body>
</html>
